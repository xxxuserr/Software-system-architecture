{% extends "base.html" %}
{% block title %}{{ product.name }} – Detalii{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<style>
.detail-container {
    max-width: 960px;
    margin: auto;
    padding: 2rem;
}

.top-section {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    align-items: flex-start;
    margin-bottom: 2rem;
}

.product-image {
    flex: 1 1 300px;
}

.product-image img {
    max-width: 100%;
    border-radius: 12px;
}

.product-info {
    flex: 2 1 400px;
}

.store-link, .fav-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0.6rem 1rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    font-size: 0.95rem;
    cursor: pointer;
}

.store-link {
    background: #007bff;
    color: #fff;
    border: none;
}

.fav-btn {
    background: #e91e63;
    color: #fff;
    border: none;
    margin-left: 1rem;
}

.specs-table {
    width: 100%;
    border-collapse: collapse;
}

.specs-table td {
    padding: 0.4rem 0.8rem;
    border-bottom: 1px solid #ddd;
}
</style>
{% endblock %}

{% block content %}
<div class="detail-container">
    <div class="top-section">
        <div class="product-image">
            <img src="{{ product.image }}" alt="{{ product.name }}">
        </div>

        <div class="product-info">
            <h1>{{ product.name }}</h1>

            {% if product.price %}
                <p class="price" style="font-size:1.5rem;color:#28a745;font-weight:bold">
                    {{ "%.2f"|format(product.price) }} {{ product.currency or "" }}
                </p>
            {% endif %}

            <div style="display:flex;flex-wrap:wrap">
                <a class="store-link" href="{{ product.link }}" target="_blank">
                    {% if logo %}
                        <img src="{{ url_for('static', filename='img/'+logo) }}" alt="{{ product.domain }}" style="height: 24px;">
                    {% endif %}
                    Mergi la magazin
                </a>

                {% if current_user.is_authenticated %}
                    <button class="fav-btn" onclick='addToFavorites("{{ product.id }}")'>
                        Adaugă la favorite
                    </button>

                {% else %}
                    <a class="fav-btn" href="{{ url_for('login') }}">Autentifică-te</a>
                {% endif %}
            </div>
        </div>
    </div>

    {% if specs %}
        <h3>Specificaţii</h3>
        <table class="specs-table">
            {% for k,v in specs.items() %}
                <tr><td><strong>{{ k }}</strong></td><td>{{ v }}</td></tr>
            {% endfor %}
        </table>
    {% endif %}
</div>

<script>
function addToFavorites(productId) {
    fetch("/add_favorite", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ product_id: productId })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message || "Adăugat!");
    })
    .catch(error => {
        console.error("Eroare:", error);
    });
}
</script>
{% endblock %}
