{% extends "base.html" %}

{% block title %}Lista de Preferin»õe - PRICER{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
{% endblock %}

{% block content %}
<script src="{{ url_for('static', filename='js/script.js') }}"></script>

<div class="profile-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="user-info">
            <img src="{{ url_for('static', filename='img/avatar_icon.png') }}" alt="Avatar" class="avatar-icon">
            <h2 class="user-name">{{ current_user.username }}</h2>
            <p class="user-email">{{ current_user.email }}</p>
        </div>
    
        <nav class="menu">
            <ul>
                <li>
                    <a href="{{ url_for('profile') }}" class="{% if request.path == url_for('profile') %}active{% endif %}">
                        <i class="fas fa-user"></i> Cabinet personal
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('favorites') }}" class="{% if request.path == url_for('favorites') %}active{% endif %}">
                        <i class="fas fa-heart"></i> Lista de preferin»õe
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('logout') }}">
                        <i class="fas fa-sign-out-alt"></i> Ie»ôire
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Con»õinutul paginii de favorite -->
    <main class="favorite">
        <h1>Produse Favorite</h1>
        <div class="favorites-grid">
            {% if favorites %}
                {% for product in favorites %}
                <div class="favorite-item" data-product-id="{{ product.id }}">

                    <a href="{{ url_for('product_detail', product_id=product.id) }}" style="text-decoration: none; color: inherit;">
                        <img src="{{ product.image }}" alt="{{ product.name }}">
                        <div class="product-info">
                            <strong>{{ product.name }}</strong><br>
                            <span class="price">
                                {{ "%.2f"|format(product.price) }} {{ product.currency or "" }}
                            </span>

                        </div>
                    </a>
                
                    <div class="alert-buttons">
                        {% if product.alert_active %}
                            <button class="btn-alert-deactivate" onclick="disablePriceAlert('{{ product.id }}')">
                                üõë DezactiveazƒÉ alerta
                            </button>
                        {% else %}
                            <button class="btn-alert-activate" onclick="setPriceAlert('{{ product.id }}')">
                                üîî ActiveazƒÉ alerta
                            </button>
                        {% endif %}
                    </div>
                
                    <button class="btn-remove" onclick="removeFromFavorites('{{ product.id }}')">‚ùå EliminƒÉ</button>
                </div>
                
                    </div>
                {% endfor %}
            {% else %}
                <p class="no-favorites">Nu ai produse favorite.</p>
            {% endif %}
        </div>
    </main>
</div>

<script>
    function runAlertCheck(event) {
        event.preventDefault();

        fetch('/run_alert_check', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(error => alert("Eroare la verificarea alertelor."));
    }
</script>
{% endblock %}
