{% extends "base.html" %}

{% block title %}Pagina principală – PRICER{% endblock %}

{% block content %}
<div class="main-content">

    <!-- SEARCH BAR -->
    <div class="search-container">
        <input type="text"
            id="search"
            placeholder="Caută un produs…"
            autocomplete="off"
            required>

        <button type="button" id="searchButton">Caută</button>

        <div class="icon-buttons">
            <a href="{{ url_for('favorites') }}" class="fav-icon">
                <i class="fas fa-heart"></i>
            </a>

            {% if current_user.is_authenticated %}
                <a href="{{ url_for('profile') }}" class="auth-icon">
                    <i class="fas fa-user"></i>
                </a>
            {% else %}
                <a href="{{ url_for('login') }}" class="auth-icon">
                    <i class="fas fa-user"></i>
                </a>
            {% endif %}
        </div>
    </div>

    <!-- SORTAREA – ascunsă implicit -->
    <div id="sort-wrapper" class="sort-container hidden">
        <label for="sort">Sortează după:</label>
        <select id="sort">
            <option value="recommended">Recomandate</option>
            <option value="price_asc">Preț crescător</option>
            <option value="price_desc">Preț descrescător</option>
        </select>
    </div>

    <!-- BANNER dacă NU sunt rezultate -->
    {% if not products %}
    <div id="banner">
        <img src="{{ url_for('static', filename='img/banner-pricer.png') }}" alt="PRICER banner" class="banner-img">
    </div>
    {% endif %}

    <!-- Loader -->
    <div id="loader" class="loader hidden"></div>

    <!-- LISTA PRODUSE -->
    <ul id="productList">
        {% for product in products %}
            {% if product.image and product.price %}
            <li class="product-card" id="card-{{ product.id }}">

                <a href="{{ url_for('product_detail', product_id=product.id) }}" class="product-image-container">
                    <img src="{{ product.image }}" alt="{{ product.name }}">
                </a>

                <button class="fav-button"
                        onclick="toggleFavorite(this)"
                        data-product-id="{{ product.id }}">
                    <i class="fa fa-heart"></i>
                </button>

                <div class="product-details">
                    <strong class="product-title">
                        <a href="{{ url_for('product_detail', product_id=product.id) }}"
                        style="color: #000; text-decoration: none; font-weight: 600;">
                            {{ product.name }}
                        </a>
                    </strong>

                    <span class="price">
                        {{ "%.2f"|format(product.price) }} {{ product.currency or "" }}
                    </span>

                    {% if product.domain %}
                    <div class="store-logo">
                        <img src="/static/img/{{ product.domain }}.png" alt="{{ product.domain }}"
                            onerror="this.style.display='none'">
                    </div>
                    {% endif %}
                </div>
            </li>
            {% endif %}
        {% endfor %}
    </ul>

    <button id="loadMoreButton" class="hidden">Încarcă mai multe</button>

    <p id="noResultsMessage" class="no-results"></p>
</div>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>

<script>
    // ➤ Arătăm sortarea DOAR după ce apar produse
    const productList = document.getElementById("productList");
    const sortWrapper = document.getElementById("sort-wrapper");

    function updateSortVisibility() {
        if (productList.children.length > 0) {
            sortWrapper.classList.remove("hidden");
        } else {
            sortWrapper.classList.add("hidden");
        }
    }

    // rulează după încărcare
    updateSortVisibility();

    // rulează dinamic când JS adaugă produse
    const observer = new MutationObserver(updateSortVisibility);
    observer.observe(productList, { childList: true });
</script>

<style>
    .hidden { display: none !important; }
</style>

{% endblock %}
